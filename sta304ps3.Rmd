---
title: "Interesting Title"
author: "Team"
date: "19/10/2020"
output: html_document
abstract: "Do abstract"
---

```{r, echo = F, warning=F, message=F}
#install.packages("tidyverse")
install.packages("gtsummary")
library(tidyverse)
library(gtsummary)
```


```{r, echo = F, warning=F, message=F}
# read in gss 2017
gss <- read_csv("inputs/gss.csv")
```


# Introduction

# Data

```{r, echo=F}
# filtering down what columns we plan to use

gss <- gss %>% 
  mutate(born_canada = ifelse(place_birth_canada == "Born in Canada", 1, 0))

used_cols <- gss %>% select(
  age, age_first_child, age_start_relationship, 
  age_at_first_marriage, age_at_first_birth, feelings_life, sex, place_birth_canada,
  place_birth_macro_region, province, pop_center, marital_status, vis_minority, 
  education, own_rent, living_arrangement, average_hours_worked, self_rated_health,
  self_rated_mental_health, regilion_importance, income_respondent, income_family,
  number_marriages, born_canada, education
)

planned_cols2 <- planned_cols %>% select(
  age, feelings_life, sex, province, marital_status, education, own_rent,
  average_hours_worked, self_rated_mental_health, self_rated_health, 
  regilion_importance, income_family, number_marriages, born_canada, education,
  age_at_first_marriage
)

planned_cols3 <- planned_cols2 %>% select(
  feelings_life, sex, income_family, self_rated_mental_health,
  marital_status, age, born_canada, self_rated_health, average_hours_worked, education,
  age_at_first_marriage
)

gss2 <- gss %>% 
  mutate(only_highschool = ifelse(grepl("high school", education, ignore.case = T), 1, 0),
         minority = ifelse(vis_minority == "Not a visible minority", 1, 0))
gss2 <- gss2 %>% 
  mutate(rent = ifelse(own_rent == "Rented, even if no cash rent is paid", 1, 0))

gss2 %>% group_by(vis_minority) %>% 
  summarise(n = n())

planned_cols3 <- planned_cols3 %>% 
  mutate(level_of_ed = ifelse(grepl("high school", education, ignore.case = T), 1, 0)) 
```

```{r}
gss2 %>% ggplot(aes(income_respondent)) + 
  geom_bar() +
  labs(title = "Figure 1: Distribution of Income Groups",
       x = "Income", y = "Count",
       caption = "Source: GSS 2017 Survey Data")

gss2 %>% ggplot(aes(education)) + 
  geom_bar() +
  labs(title = "Figure 2: Distribution of Education Groups",
       x = "Education Level", y = "Count",
       caption = "Source: GSS 2017 Survey Data") +
  coord_flip()
```



# Model

We plan to run a logistic regression model in the form:

$$log \left( \frac{\hat{p}}{1-\hat{p}} \right) = \beta_1 + \beta_2*x_{children} + \beta_3*x_{male} + \beta_4*x_{income > 125000} + \beta_5*x_{income_{25000-49999}} + \\ \beta_6*x_{income_{50000 - 74999}} + \beta_7*x_{income_{75000-99999}} + \beta_8*x_{income_{< 25000}} + \beta_9*x_{marraige} + \beta_{10}*x_{rent}$$
where each $\alpha$ refers to self rated health and mental health, age and whether the person is born in Canada. The notation $i[i]$ refers to a person's individual income, $r[i]$ represent whether a person is renting their house or not, $g[i]$ represents a person's gender, for this scenario it has been restricted to male/female and lastly, .

The value we want to predict is whether or not someone has had a higher education, more specifically, we restrict it to a variable which gives a 1 for if a person has only completed high school and a 0 if they've completed some other level of education.

This model was run using the glm. The glm function was run with the family being specified as binomial() because our response variable "only_highschool" is a binary variable with responses of "yes" or "no".

The ouput of our model gives us a probability of whether someone has only completed high school. 


```{r}
# run the model with feeling of life as the response, born in canada, mental health, 
# and age being the predictors

gss2 <- gss2 %>% 
  mutate(married = ifelse(marital_status == "Married", 1, 0))

gss_logit <- glm(only_highschool ~ number_total_children_known +
                   sex + income_respondent + rent + married,
                 data = gss2, family = binomial())
#gtsummary::tbl_regression(gss_logit, intercept = T)
```

# Results

Figure 3
```{r}
# visualize the model
summary(gss_logit)
logit_summary <- broom::tidy(gss_logit, conf.int = T)
logit_summary
```

Using the glm() function, we find that our logit function is:

$$log \left( \frac{\hat{p}}{1-\hat{p}} \right) = -1.52 - .5*x_{children}
- .455*x_{male} +-.147*x_{income > 125000} + 1.5*x_{income_{25000-49999}} + \\ .76*x_{income_{50000 - 74999}} + .265*x_{income_{75000-99999}} + 2.22*x_{income_{< 25000}} + .61*x_{marraige} + .116*x_{rent}$$

The output of this model is not like other regressions where we plug in numbers and receive our value right away, we have to do a little more work for this one. Every term in this equation will either be multiplied by 1 or 0, if the person has that characteristic or not. You may notice that some categories are missing, such as the female gender, income from 100000-124999 dollars and not born in Canada. These are missing becuase the function takes the other values as default ideal values, so for every difference in the category, the probability of having only a high school diploma, goes down.


```{r}
# get summary and plot coefficients
logit_summary %>% ggplot(aes(term, estimate)) + geom_point() + 
  geom_errorbar(aes(ymin = conf.low, ymax = conf.high),
                width = .5, colour = "red") +
  geom_hline(aes(yintercept = 0), color = "black", linetype = "dashed") +
  coord_flip() + 
  labs(title = "Figure 4: Distribution of Estimation of Coefficients",
       subtitle = "Red bars represent estimated error",
       y = "Weight",
       x = "Estimate",
       caption = "Source: GSS 2017 Data")
```

This graph shows the distribution of coefficients for each variable covered, with the standard error extended to the left and right. There is a bar in the middle of the graph (at x = 0), to help visualize whether the variable has increases the probability of a person only completing high school.

Figure 5
```{r}
gtsummary::tbl_regression(gss_logit, intercept = T)
```

This is another way of looking at our coefficients, we can find odd ratios of each category impacting whether or not someone has only completed high school. The way we intepret these odd ratios are through the decimal points of the ratios. If one outcome is n decimal places higher, the odds of it impacting the model's decision are n times more likely. For example, we see that the odds ratio for Males is 0.45, which means that males are 45% more likely to have only completed high school. The same idea applies for negative values, it means they are less likely to impact. 

We can also look at the p-values, to see which results are the most statistically significant. P-values are used with null hypotheses to determine if an experiment is significant. Since our p-values are under the traditional benchmark of 0.05, we can reject our null-hypothesis and conclude that these results are in-fact, significant.

# Discussion

## Analysis

## Weaknesses and Next Steps

# Appendicies

## Citations

- R Core Team (2019). R: A language and environment for statistical computing. R Foundation for
  Statistical Computing, Vienna, Austria. URL https://www.R-project.org/.
  
- JJ Allaire and Yihui Xie and Jonathan McPherson and Javier Luraschi and Kevin Ushey and Aron
  Atkins and Hadley Wickham and Joe Cheng and Winston Chang and Richard Iannone (2020).
  rmarkdown: Dynamic Documents for R. R package version 2.3. URL https://rmarkdown.rstudio.com.

- Wickham et al., (2019). Welcome to the tidyverse. Journal of Open Source Software, 4(43),
  1686, https://doi.org/10.21105/joss.01686
  
- Rohan Alexander and Sam Caetano (2020). Cleaning the GSS 2017 file.

- Yihui Xie (2020). knitr: A General-Purpose Package for Dynamic Report Generation in R. R
  package version 1.28.

## Code
  
Code that supports this analysis can be found at https://github.com/matthewwankiewicz/sta304ps3