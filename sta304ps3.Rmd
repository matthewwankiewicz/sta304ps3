---
title: "Interesting Title"
author: "Team"
date: "19/10/2020"
output: html_document
abstract: "Do abstract"
---

```{r}
#install.packages("tidyverse")
#install.packages("brms")
#install.packages("rstan")
library(tidyverse)
library(brms)
```


```{r}
# read in gss 2017

gss <- read_csv("inputs/gss.csv")
```


# Introduction

# Data

```{r}
# filtering down what columns we plan to use

gss <- gss %>% 
  mutate(born_canada = ifelse(place_birth_canada == "Born in Canada", 1, 0))

planned_cols <- gss %>% select(
  age, age_first_child, age_start_relationship, 
  age_at_first_marriage, age_at_first_birth, feelings_life, sex, place_birth_canada,
  place_birth_macro_region, province, pop_center, marital_status, vis_minority, 
  education, own_rent, living_arrangement, average_hours_worked, self_rated_health,
  self_rated_mental_health, regilion_importance, income_respondent, income_family,
  number_marriages, born_canada
)

planned_cols2 <- planned_cols %>% select(
  age, feelings_life, sex, province, marital_status, education, own_rent,
  average_hours_worked, self_rated_mental_health, self_rated_health, 
  regilion_importance, income_family, number_marriages, born_canada
)

planned_cols3 <- planned_cols2 %>% select(
  feelings_life, sex, income_family, self_rated_mental_health,
  marital_status, age, born_canada, self_rated_health, average_hours_worked
)

#planned age groups for now: 15-35, 35-65, 65+

test <- planned_cols3 %>% 
  drop_na(self_rated_mental_health) %>% 
  filter(self_rated_mental_health != "Don't Know") %>% 
  mutate(happy = ifelse(feelings_life > 5, 1, 0),
         mental_health = ifelse(self_rated_mental_health == "Excellent", 5,
                                ifelse(self_rated_mental_health == "Very Good", 4,
                                       ifelse(self_rated_mental_health == "Good", 3,
                                              ifelse(self_rated_mental_health == "Fair", 2, 1)))))

# create new variable, grouping ages by 5's
test <- test %>% 
  mutate(age_groups = cut(age,
                          breaks = c(seq(15,80, by = 5), Inf),
                          labels = seq(15, 80, by = 5), right = F))

test <- test %>% 
  mutate(health = ifelse(self_rated_health == "Excellent", 5,
                                ifelse(self_rated_health == "Very Good", 4,
                                       ifelse(self_rated_health == "Good", 3,
                                              ifelse(self_rated_health == "Fair", 2, 1)))))

test <- test %>% 
  mutate(avg_health = round((health + mental_health)/2))

test <- test %>% 
  mutate(avg_health_word = ifelse(avg_health == 1, "Poor",
                                  ifelse(avg_health == 2, "Fair",
                                         ifelse(avg_health == 3, "Good",
                                                ifelse(avg_health == 4, "Very Good", "Excellant")))))
```

# Model

We plan to run a logistic regression model in the form:

$$Pr(y_i = 1) = logit^{-1} \left( \alpha^{health}_{h[i]} + \alpha^{mental health}_{m[i]} + \alpha^{income}_{i[i]} + \alpha^{canada}_{c[i]}\right)$$
where each $\alpha$ refers to self rated health and mental health, age and whether the person is born in Canada. The notation $h[i]$ refers to a the health rating individual $i$ gives themselves, $m[i]$ refers to the mental health rating person $i$ gave themselves, $i[i]$ refers to the household income of person $i$ and lastly, $c[i]$ refers to whether the person is born in Canada or not. 

These are modelled in the form of: $$\alpha_h^{health} \sim  N(0, \sigma_{health})$$ for s = 1, 2, ... I. The same follows for the other distributions.

This model was run using the brms package in R and specifically using the brm function from this package. The brm function was run with the family being specified as bernoulli() because our response variable "happy" is a binary variable with responses of "yes" or "no".

```{r}
# run the model with feeling of life as the response, born in canada, mental health, 
# and age being the predictors

model2 <- brm(happy ~  avg_health_word +
              income_family + born_canada, data = test,
              family = bernoulli(), seed = 21)

summary(model2)
```


```{r}
# get summary and plot coefficients
summary(model)
mcmc_plot(model2)
```



# Discussion

## Analysis

## Weaknesses and Next Steps

# Appendicies

## Citations

- R Core Team (2019). R: A language and environment for statistical computing. R Foundation for
  Statistical Computing, Vienna, Austria. URL https://www.R-project.org/.

- Paul-Christian Bürkner (2017). brms: An R Package for Bayesian Multilevel Models Using Stan.
  Journal of Statistical Software, 80(1), 1-28. doi:10.18637/jss.v080.i01

- Paul-Christian Bürkner (2018). Advanced Bayesian Multilevel Modeling with the R Package brms.
  The R Journal, 10(1), 395-411. doi:10.32614/RJ-2018-017
  
- JJ Allaire and Yihui Xie and Jonathan McPherson and Javier Luraschi and Kevin Ushey and Aron
  Atkins and Hadley Wickham and Joe Cheng and Winston Chang and Richard Iannone (2020).
  rmarkdown: Dynamic Documents for R. R package version 2.3. URL https://rmarkdown.rstudio.com.

- Wickham et al., (2019). Welcome to the tidyverse. Journal of Open Source Software, 4(43),
  1686, https://doi.org/10.21105/joss.01686
  
- Rohan Alexander and Sam Caetano (2020). Cleaning the GSS 2017 file.
  