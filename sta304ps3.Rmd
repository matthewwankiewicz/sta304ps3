---
title: "Interesting Title"
author: "Team"
date: "19/10/2020"
output: html_document
abstract: "Do abstract"
---

```{r}
#install.packages("tidyverse")
library(tidyverse)
```


```{r}
# read in gss 2017
gss <- read_csv("inputs/gss.csv")
```


# Introduction

# Data

```{r}
# filtering down what columns we plan to use

gss <- gss %>% 
  mutate(born_canada = ifelse(place_birth_canada == "Born in Canada", 1, 0))

planned_cols <- gss %>% select(
  age, age_first_child, age_start_relationship, 
  age_at_first_marriage, age_at_first_birth, feelings_life, sex, place_birth_canada,
  place_birth_macro_region, province, pop_center, marital_status, vis_minority, 
  education, own_rent, living_arrangement, average_hours_worked, self_rated_health,
  self_rated_mental_health, regilion_importance, income_respondent, income_family,
  number_marriages, born_canada
)

planned_cols2 <- planned_cols %>% select(
  age, feelings_life, sex, province, marital_status, education, own_rent,
  average_hours_worked, self_rated_mental_health, self_rated_health, 
  regilion_importance, income_family, number_marriages, born_canada
)

planned_cols3 <- planned_cols2 %>% select(
  feelings_life, sex, income_family, self_rated_mental_health,
  marital_status, age, born_canada, self_rated_health, average_hours_worked
)

#planned age groups for now: 15-35, 35-65, 65+

test <- planned_cols3 %>% 
  drop_na(self_rated_mental_health) %>% 
  filter(self_rated_mental_health != "Don't Know") %>% 
  mutate(happy = ifelse(feelings_life > 5, 1, 0),
         mental_health = ifelse(self_rated_mental_health == "Excellent", 5,
                                ifelse(self_rated_mental_health == "Very Good", 4,
                                       ifelse(self_rated_mental_health == "Good", 3,
                                              ifelse(self_rated_mental_health == "Fair", 2, 1)))))

# create new variable, grouping ages by 5's
test <- test %>% 
  mutate(age_groups = cut(age,
                          breaks = c(seq(15,80, by = 5), Inf),
                          labels = seq(15, 80, by = 5), right = F))

test <- test %>% 
  mutate(health = ifelse(self_rated_health == "Excellent", 5,
                                ifelse(self_rated_health == "Very Good", 4,
                                       ifelse(self_rated_health == "Good", 3,
                                              ifelse(self_rated_health == "Fair", 2, 1)))))

test <- test %>% 
  mutate(avg_health = round((health + mental_health)/2))

test <- test %>% 
  mutate(avg_health_word = ifelse(avg_health == 1, "Poor",
                                  ifelse(avg_health == 2, "Fair",
                                         ifelse(avg_health == 3, "Good",
                                                ifelse(avg_health == 4, "Very Good", "Excellant")))))
```

# Model

We plan to run a logistic regression model in the form:

$$Pr(y_i = 1) = logit^{-1} \left( \alpha^{health}_{h[i]} + \alpha^{income}_{i[i]} + \alpha^{canada}_{c[i]}\right)$$
where each $\alpha$ refers to self rated health and mental health, age and whether the person is born in Canada. The notation $h[i]$ refers to a the health rating individual $i$ gives themselves, $i[i]$ refers to the household income of person $i$ and lastly, $c[i]$ refers to whether the person is born in Canada or not. 

This model was run using the glm. The glm function was run with the family being specified as binomial() because our response variable "happy" is a binary variable with responses of "yes" or "no".

The ouput of our model gives us a probability

```{r}
# run the model with feeling of life as the response, born in canada, mental health, 
# and age being the predictors

model_lm <- glm(happy ~ sex+ income_family + born_canada +
                          avg_health_word, data = test, 
                family = binomial())

summary(model_lm)
coefficients <- broom::tidy(model_lm)
coefficients <- coefficients %>% 
  mutate(upper_error = estimate + std.error,
         lower_error = estimate - std.error)
```


```{r}
# get summary and plot coefficients
coefficients %>% ggplot(aes(term, estimate)) + geom_point() + 
  geom_errorbar(aes(ymin = lower_error, ymax = upper_error),
                width = .5, colour = "red") +
  coord_flip()
```



# Discussion

## Analysis

## Weaknesses and Next Steps

# Appendicies

## Citations

- R Core Team (2019). R: A language and environment for statistical computing. R Foundation for
  Statistical Computing, Vienna, Austria. URL https://www.R-project.org/.
  
- JJ Allaire and Yihui Xie and Jonathan McPherson and Javier Luraschi and Kevin Ushey and Aron
  Atkins and Hadley Wickham and Joe Cheng and Winston Chang and Richard Iannone (2020).
  rmarkdown: Dynamic Documents for R. R package version 2.3. URL https://rmarkdown.rstudio.com.

- Wickham et al., (2019). Welcome to the tidyverse. Journal of Open Source Software, 4(43),
  1686, https://doi.org/10.21105/joss.01686
  
- Rohan Alexander and Sam Caetano (2020). Cleaning the GSS 2017 file.

## Code
  
Code supports this analysis can be found at https://github.com/matthewwankiewicz/sta304ps3